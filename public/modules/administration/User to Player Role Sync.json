{
    "name": "User to Player Role Sync",
    "author": "Mad",
    "supportedGames": [
        "all"
    ],
    "versions": [
        {
            "tag": "latest",
            "description": "Automatically syncs role assignments from users to their linked in-game players. When a Discord user is assigned or removed from a role, this module ensures that the role is also assigned or removed from their connected in-game player profile.",
            "configSchema": "{\"$schema\":\"http://json-schema.org/draft-07/schema#\",\"type\":\"object\",\"properties\":{},\"required\":[],\"additionalProperties\":false}",
            "uiSchema": "{}",
            "commands": [],
            "hooks": [
                {
                    "function": "import { takaro, data, TakaroUserError } from '@takaro/helpers';\n\nasync function main() {\n    console.log('[User Role Sync] Hook triggered');\n    \n    const eventMeta = data.eventData;\n    const roleId = eventMeta?.role?.id;\n    \n    if (!roleId) {\n        console.error('[User Role Sync] No role ID found in event meta');\n        return { success: false, message: 'No role ID found' };\n    }\n    \n    console.log(`[User Role Sync] Looking for recent role event for role ${roleId}`);\n    \n    // This is the onRoleRemoved hook (ID: 2de7ef01-fe9b-4276-93b0-1c3d024062af)\n    const eventType = 'role-removed';\n    \n    console.log(`[User Role Sync] Searching for ${eventType} events with role ${roleId}`);\n    \n    // Search for recent events with this role\n    let matchingEvents;\n    try {\n        const eventsResponse = await takaro.event.eventControllerSearch({\n            filters: { eventName: [eventType] },\n            sortBy: 'createdAt',\n            sortDirection: 'desc',\n            limit: 20\n        });\n        matchingEvents = eventsResponse.data.data;\n        console.log(`[User Role Sync] Found ${matchingEvents.length} recent ${eventType} events`);\n    } catch (error) {\n        console.error('[User Role Sync] Failed to search for events:', error);\n        return { success: false, message: 'Failed to search for events' };\n    }\n    \n    // Find the event that matches our role and is recent\n    const matchingEvent = matchingEvents.find(e => e.meta?.role?.id === roleId && e.userId && !e.playerId);\n    \n    if (!matchingEvent) {\n        console.log('[User Role Sync] No matching user role event found, skipping');\n        return { success: false, message: 'No matching user role event found' };\n    }\n    \n    const userId = matchingEvent.userId;\n    console.log(`[User Role Sync] Found matching event for user ${userId}`);\n    \n    // Get the user to find their linked player\n    let user;\n    try {\n        const userResponse = await takaro.user.userControllerGetOne(userId);\n        user = userResponse.data.data;\n        console.log('[User Role Sync] Found user:', user.name, 'with playerId:', user.playerId);\n    } catch (error) {\n        console.error('[User Role Sync] Failed to get user:', error);\n        return { success: false, message: 'Failed to get user' };\n    }\n    \n    if (!user.playerId) {\n        console.log('[User Role Sync] User has no linked player, skipping');\n        return { success: false, message: 'User has no linked player' };\n    }\n    \n    // Get the player to check if they still have the role\n    let player;\n    try {\n        const playerResponse = await takaro.player.playerControllerGetOne(user.playerId);\n        player = playerResponse.data.data;\n        console.log('[User Role Sync] Retrieved player, checking current roles');\n    } catch (error) {\n        console.error('[User Role Sync] Failed to get player:', error);\n        return { success: false, message: 'Failed to get player' };\n    }\n    \n    // Check if player still has this role\n    const hasRole = player.roleAssignments?.some(ra => ra.role.id === roleId);\n    \n    if (!hasRole) {\n        console.log(`[User Role Sync] Player does not have role ${roleId}, skipping`);\n        return { success: true, message: 'Player does not have role' };\n    }\n    \n    console.log(`[User Role Sync] Removing role ${roleId} from user ${user.id} to player ${user.playerId}`);\n    \n    try {\n        await takaro.player.playerControllerRemoveRole(user.playerId, roleId, {});\n        console.log(`[User Role Sync] Successfully removed role ${roleId} from player ${user.playerId}`);\n        \n        return { \n            success: true, \n            message: `Role removed from player ${user.playerId}` \n        };\n    } catch (error) {\n        console.error(`[User Role Sync] Failed to sync role:`, error);\n        return { \n            success: false, \n            message: `Failed to sync role: ${error.message}` \n        };\n    }\n}\n\nawait main();",
                    "name": "onRoleRemoved",
                    "description": "Syncs role removals from users to their linked players",
                    "eventType": "role-removed",
                    "regex": ""
                },
                {
                    "function": "import { takaro, data, TakaroUserError } from '@takaro/helpers';\n\nasync function main() {\n    console.log('[User Role Sync] Hook triggered');\n    \n    const eventMeta = data.eventData;\n    const roleId = eventMeta?.role?.id;\n    \n    if (!roleId) {\n        console.error('[User Role Sync] No role ID found in event meta');\n        return { success: false, message: 'No role ID found' };\n    }\n    \n    console.log(`[User Role Sync] Looking for recent role event for role ${roleId}`);\n    \n    // This is the onRoleAssigned hook (ID: d01580ca-1550-4abc-abab-addca12ddf17)\n    const eventType = 'role-assigned';\n    \n    console.log(`[User Role Sync] Searching for ${eventType} events with role ${roleId}`);\n    \n    // Search for recent events with this role\n    let matchingEvents;\n    try {\n        const eventsResponse = await takaro.event.eventControllerSearch({\n            filters: { eventName: [eventType] },\n            sortBy: 'createdAt',\n            sortDirection: 'desc',\n            limit: 20\n        });\n        matchingEvents = eventsResponse.data.data;\n        console.log(`[User Role Sync] Found ${matchingEvents.length} recent ${eventType} events`);\n    } catch (error) {\n        console.error('[User Role Sync] Failed to search for events:', error);\n        return { success: false, message: 'Failed to search for events' };\n    }\n    \n    // Find the event that matches our role and is recent\n    const matchingEvent = matchingEvents.find(e => e.meta?.role?.id === roleId && e.userId && !e.playerId);\n    \n    if (!matchingEvent) {\n        console.log('[User Role Sync] No matching user role event found, skipping');\n        return { success: false, message: 'No matching user role event found' };\n    }\n    \n    const userId = matchingEvent.userId;\n    console.log(`[User Role Sync] Found matching event for user ${userId}`);\n    \n    // Get the user to find their linked player\n    let user;\n    try {\n        const userResponse = await takaro.user.userControllerGetOne(userId);\n        user = userResponse.data.data;\n        console.log('[User Role Sync] Found user:', user.name, 'with playerId:', user.playerId);\n    } catch (error) {\n        console.error('[User Role Sync] Failed to get user:', error);\n        return { success: false, message: 'Failed to get user' };\n    }\n    \n    if (!user.playerId) {\n        console.log('[User Role Sync] User has no linked player, skipping');\n        return { success: false, message: 'User has no linked player' };\n    }\n    \n    // Get the player to check if they already have the role\n    let player;\n    try {\n        const playerResponse = await takaro.player.playerControllerGetOne(user.playerId);\n        player = playerResponse.data.data;\n        console.log('[User Role Sync] Retrieved player, checking current roles');\n    } catch (error) {\n        console.error('[User Role Sync] Failed to get player:', error);\n        return { success: false, message: 'Failed to get player' };\n    }\n    \n    // Check if player already has this role\n    const hasRole = player.roleAssignments?.some(ra => ra.role.id === roleId);\n    \n    if (hasRole) {\n        console.log(`[User Role Sync] Player already has role ${roleId}, skipping`);\n        return { success: true, message: 'Player already has role' };\n    }\n    \n    console.log(`[User Role Sync] Assigning role ${roleId} from user ${user.id} to player ${user.playerId}`);\n    \n    try {\n        await takaro.player.playerControllerAssignRole(user.playerId, roleId, {});\n        console.log(`[User Role Sync] Successfully assigned role ${roleId} to player ${user.playerId}`);\n        \n        return { \n            success: true, \n            message: `Role assigned to player ${user.playerId}` \n        };\n    } catch (error) {\n        console.error(`[User Role Sync] Failed to sync role:`, error);\n        return { \n            success: false, \n            message: `Failed to sync role: ${error.message}` \n        };\n    }\n}\n\nawait main();",
                    "name": "onRoleAssigned",
                    "description": "Syncs role assignments from users to their linked players",
                    "eventType": "role-assigned",
                    "regex": ""
                }
            ],
            "cronJobs": [],
            "functions": [
                {
                    "function": "import { takaro, data, TakaroUserError } from '@takaro/helpers';\n\nasync function main() {\n    console.log('[User Role Sync] Hook triggered');\n    \n    const eventMeta = data.eventData;\n    const roleId = eventMeta?.role?.id;\n    \n    if (!roleId) {\n        console.error('[User Role Sync] No role ID found in event meta');\n        return { success: false, message: 'No role ID found' };\n    }\n    \n    console.log(`[User Role Sync] Looking for recent role event for role ${roleId}`);\n    \n    // Query for the recent role-assigned or role-removed event that triggered this hook\n    // We need to find events from the last few seconds with this role\n    const timestamp = eventMeta.timestamp;\n    const eventType = data.itemId.includes('onRoleAssigned') ? 'role-assigned' : 'role-removed';\n    \n    console.log(`[User Role Sync] Searching for ${eventType} events with role ${roleId}`);\n    \n    // Search for recent events with this role\n    let matchingEvents;\n    try {\n        const eventsResponse = await takaro.event.eventControllerSearch({\n            filters: { eventName: [eventType] },\n            sortBy: 'createdAt',\n            sortDirection: 'desc',\n            limit: 20\n        });\n        matchingEvents = eventsResponse.data.data;\n        console.log(`[User Role Sync] Found ${matchingEvents.length} recent ${eventType} events`);\n    } catch (error) {\n        console.error('[User Role Sync] Failed to search for events:', error);\n        return { success: false, message: 'Failed to search for events' };\n    }\n    \n    // Find the event that matches our role and is recent\n    const matchingEvent = matchingEvents.find(e => e.meta?.role?.id === roleId && e.userId && !e.playerId);\n    \n    if (!matchingEvent) {\n        console.log('[User Role Sync] No matching user role event found, skipping');\n        return { success: false, message: 'No matching user role event found' };\n    }\n    \n    const userId = matchingEvent.userId;\n    console.log(`[User Role Sync] Found matching event for user ${userId}`);\n    \n    // Get the user to find their linked player\n    let user;\n    try {\n        const userResponse = await takaro.user.userControllerGetOne(userId);\n        user = userResponse.data.data;\n        console.log('[User Role Sync] Found user:', user.name, 'with playerId:', user.playerId);\n    } catch (error) {\n        console.error('[User Role Sync] Failed to get user:', error);\n        return { success: false, message: 'Failed to get user' };\n    }\n    \n    if (!user.playerId) {\n        console.log('[User Role Sync] User has no linked player, skipping');\n        return { success: false, message: 'User has no linked player' };\n    }\n    \n    console.log(`[User Role Sync] Syncing role ${roleId} from user ${user.id} to player ${user.playerId}`);\n    \n    try {\n        const isAssignment = eventType === 'role-assigned';\n        \n        if (isAssignment) {\n            await takaro.player.playerControllerAssignRole(user.playerId, roleId, {});\n            console.log(`[User Role Sync] Successfully assigned role ${roleId} to player ${user.playerId}`);\n        } else {\n            await takaro.player.playerControllerRemoveRole(user.playerId, roleId, {});\n            console.log(`[User Role Sync] Successfully removed role ${roleId} from player ${user.playerId}`);\n        }\n        \n        return { \n            success: true, \n            message: `Role ${isAssignment ? 'assigned to' : 'removed from'} player ${user.playerId}` \n        };\n    } catch (error) {\n        console.error(`[User Role Sync] Failed to sync role:`, error);\n        return { \n            success: false, \n            message: `Failed to sync role: ${error.message}` \n        };\n    }\n}\n\nawait main();\n",
                    "name": "syncUserRoleToPlayer",
                    "description": "Syncs role assignments from users to their linked players"
                }
            ],
            "permissions": []
        },
        {
            "tag": "1.1.0",
            "description": "Automatically syncs role assignments from users to their linked in-game players. When a Discord user is assigned or removed from a role, this module ensures that the role is also assigned or removed from their connected in-game player profile.",
            "configSchema": "{\"$schema\":\"http://json-schema.org/draft-07/schema#\",\"type\":\"object\",\"properties\":{},\"required\":[],\"additionalProperties\":false}",
            "uiSchema": "{}",
            "commands": [],
            "hooks": [
                {
                    "function": "import { takaro, data, TakaroUserError } from '@takaro/helpers';\n\nasync function main() {\n    console.log('[User Role Sync] Hook triggered');\n    \n    const eventMeta = data.eventData;\n    const roleId = eventMeta?.role?.id;\n    \n    if (!roleId) {\n        console.error('[User Role Sync] No role ID found in event meta');\n        return { success: false, message: 'No role ID found' };\n    }\n    \n    console.log(`[User Role Sync] Looking for recent role event for role ${roleId}`);\n    \n    // This is the onRoleRemoved hook (ID: 2de7ef01-fe9b-4276-93b0-1c3d024062af)\n    const eventType = 'role-removed';\n    \n    console.log(`[User Role Sync] Searching for ${eventType} events with role ${roleId}`);\n    \n    // Search for recent events with this role\n    let matchingEvents;\n    try {\n        const eventsResponse = await takaro.event.eventControllerSearch({\n            filters: { eventName: [eventType] },\n            sortBy: 'createdAt',\n            sortDirection: 'desc',\n            limit: 20\n        });\n        matchingEvents = eventsResponse.data.data;\n        console.log(`[User Role Sync] Found ${matchingEvents.length} recent ${eventType} events`);\n    } catch (error) {\n        console.error('[User Role Sync] Failed to search for events:', error);\n        return { success: false, message: 'Failed to search for events' };\n    }\n    \n    // Find the event that matches our role and is recent\n    const matchingEvent = matchingEvents.find(e => e.meta?.role?.id === roleId && e.userId && !e.playerId);\n    \n    if (!matchingEvent) {\n        console.log('[User Role Sync] No matching user role event found, skipping');\n        return { success: false, message: 'No matching user role event found' };\n    }\n    \n    const userId = matchingEvent.userId;\n    console.log(`[User Role Sync] Found matching event for user ${userId}`);\n    \n    // Get the user to find their linked player\n    let user;\n    try {\n        const userResponse = await takaro.user.userControllerGetOne(userId);\n        user = userResponse.data.data;\n        console.log('[User Role Sync] Found user:', user.name, 'with playerId:', user.playerId);\n    } catch (error) {\n        console.error('[User Role Sync] Failed to get user:', error);\n        return { success: false, message: 'Failed to get user' };\n    }\n    \n    if (!user.playerId) {\n        console.log('[User Role Sync] User has no linked player, skipping');\n        return { success: false, message: 'User has no linked player' };\n    }\n    \n    // Get the player to check if they still have the role\n    let player;\n    try {\n        const playerResponse = await takaro.player.playerControllerGetOne(user.playerId);\n        player = playerResponse.data.data;\n        console.log('[User Role Sync] Retrieved player, checking current roles');\n    } catch (error) {\n        console.error('[User Role Sync] Failed to get player:', error);\n        return { success: false, message: 'Failed to get player' };\n    }\n    \n    // Check if player still has this role\n    const hasRole = player.roleAssignments?.some(ra => ra.role.id === roleId);\n    \n    if (!hasRole) {\n        console.log(`[User Role Sync] Player does not have role ${roleId}, skipping`);\n        return { success: true, message: 'Player does not have role' };\n    }\n    \n    console.log(`[User Role Sync] Removing role ${roleId} from user ${user.id} to player ${user.playerId}`);\n    \n    try {\n        await takaro.player.playerControllerRemoveRole(user.playerId, roleId, {});\n        console.log(`[User Role Sync] Successfully removed role ${roleId} from player ${user.playerId}`);\n        \n        return { \n            success: true, \n            message: `Role removed from player ${user.playerId}` \n        };\n    } catch (error) {\n        console.error(`[User Role Sync] Failed to sync role:`, error);\n        return { \n            success: false, \n            message: `Failed to sync role: ${error.message}` \n        };\n    }\n}\n\nawait main();",
                    "name": "onRoleRemoved",
                    "description": null,
                    "eventType": "role-removed",
                    "regex": ""
                },
                {
                    "function": "import { takaro, data, TakaroUserError } from '@takaro/helpers';\n\nasync function main() {\n    console.log('[User Role Sync] Hook triggered');\n    \n    const eventMeta = data.eventData;\n    const roleId = eventMeta?.role?.id;\n    \n    if (!roleId) {\n        console.error('[User Role Sync] No role ID found in event meta');\n        return { success: false, message: 'No role ID found' };\n    }\n    \n    console.log(`[User Role Sync] Looking for recent role event for role ${roleId}`);\n    \n    // This is the onRoleAssigned hook (ID: d01580ca-1550-4abc-abab-addca12ddf17)\n    const eventType = 'role-assigned';\n    \n    console.log(`[User Role Sync] Searching for ${eventType} events with role ${roleId}`);\n    \n    // Search for recent events with this role\n    let matchingEvents;\n    try {\n        const eventsResponse = await takaro.event.eventControllerSearch({\n            filters: { eventName: [eventType] },\n            sortBy: 'createdAt',\n            sortDirection: 'desc',\n            limit: 20\n        });\n        matchingEvents = eventsResponse.data.data;\n        console.log(`[User Role Sync] Found ${matchingEvents.length} recent ${eventType} events`);\n    } catch (error) {\n        console.error('[User Role Sync] Failed to search for events:', error);\n        return { success: false, message: 'Failed to search for events' };\n    }\n    \n    // Find the event that matches our role and is recent\n    const matchingEvent = matchingEvents.find(e => e.meta?.role?.id === roleId && e.userId && !e.playerId);\n    \n    if (!matchingEvent) {\n        console.log('[User Role Sync] No matching user role event found, skipping');\n        return { success: false, message: 'No matching user role event found' };\n    }\n    \n    const userId = matchingEvent.userId;\n    console.log(`[User Role Sync] Found matching event for user ${userId}`);\n    \n    // Get the user to find their linked player\n    let user;\n    try {\n        const userResponse = await takaro.user.userControllerGetOne(userId);\n        user = userResponse.data.data;\n        console.log('[User Role Sync] Found user:', user.name, 'with playerId:', user.playerId);\n    } catch (error) {\n        console.error('[User Role Sync] Failed to get user:', error);\n        return { success: false, message: 'Failed to get user' };\n    }\n    \n    if (!user.playerId) {\n        console.log('[User Role Sync] User has no linked player, skipping');\n        return { success: false, message: 'User has no linked player' };\n    }\n    \n    // Get the player to check if they already have the role\n    let player;\n    try {\n        const playerResponse = await takaro.player.playerControllerGetOne(user.playerId);\n        player = playerResponse.data.data;\n        console.log('[User Role Sync] Retrieved player, checking current roles');\n    } catch (error) {\n        console.error('[User Role Sync] Failed to get player:', error);\n        return { success: false, message: 'Failed to get player' };\n    }\n    \n    // Check if player already has this role\n    const hasRole = player.roleAssignments?.some(ra => ra.role.id === roleId);\n    \n    if (hasRole) {\n        console.log(`[User Role Sync] Player already has role ${roleId}, skipping`);\n        return { success: true, message: 'Player already has role' };\n    }\n    \n    console.log(`[User Role Sync] Assigning role ${roleId} from user ${user.id} to player ${user.playerId}`);\n    \n    try {\n        await takaro.player.playerControllerAssignRole(user.playerId, roleId, {});\n        console.log(`[User Role Sync] Successfully assigned role ${roleId} to player ${user.playerId}`);\n        \n        return { \n            success: true, \n            message: `Role assigned to player ${user.playerId}` \n        };\n    } catch (error) {\n        console.error(`[User Role Sync] Failed to sync role:`, error);\n        return { \n            success: false, \n            message: `Failed to sync role: ${error.message}` \n        };\n    }\n}\n\nawait main();",
                    "name": "onRoleAssigned",
                    "description": null,
                    "eventType": "role-assigned",
                    "regex": ""
                }
            ],
            "cronJobs": [],
            "functions": [
                {
                    "function": "import { takaro, data, TakaroUserError } from '@takaro/helpers';\n\nasync function main() {\n    console.log('[User Role Sync] Hook triggered');\n    \n    const eventMeta = data.eventData;\n    const roleId = eventMeta?.role?.id;\n    \n    if (!roleId) {\n        console.error('[User Role Sync] No role ID found in event meta');\n        return { success: false, message: 'No role ID found' };\n    }\n    \n    console.log(`[User Role Sync] Looking for recent role event for role ${roleId}`);\n    \n    // Query for the recent role-assigned or role-removed event that triggered this hook\n    // We need to find events from the last few seconds with this role\n    const timestamp = eventMeta.timestamp;\n    const eventType = data.itemId.includes('onRoleAssigned') ? 'role-assigned' : 'role-removed';\n    \n    console.log(`[User Role Sync] Searching for ${eventType} events with role ${roleId}`);\n    \n    // Search for recent events with this role\n    let matchingEvents;\n    try {\n        const eventsResponse = await takaro.event.eventControllerSearch({\n            filters: { eventName: [eventType] },\n            sortBy: 'createdAt',\n            sortDirection: 'desc',\n            limit: 20\n        });\n        matchingEvents = eventsResponse.data.data;\n        console.log(`[User Role Sync] Found ${matchingEvents.length} recent ${eventType} events`);\n    } catch (error) {\n        console.error('[User Role Sync] Failed to search for events:', error);\n        return { success: false, message: 'Failed to search for events' };\n    }\n    \n    // Find the event that matches our role and is recent\n    const matchingEvent = matchingEvents.find(e => e.meta?.role?.id === roleId && e.userId && !e.playerId);\n    \n    if (!matchingEvent) {\n        console.log('[User Role Sync] No matching user role event found, skipping');\n        return { success: false, message: 'No matching user role event found' };\n    }\n    \n    const userId = matchingEvent.userId;\n    console.log(`[User Role Sync] Found matching event for user ${userId}`);\n    \n    // Get the user to find their linked player\n    let user;\n    try {\n        const userResponse = await takaro.user.userControllerGetOne(userId);\n        user = userResponse.data.data;\n        console.log('[User Role Sync] Found user:', user.name, 'with playerId:', user.playerId);\n    } catch (error) {\n        console.error('[User Role Sync] Failed to get user:', error);\n        return { success: false, message: 'Failed to get user' };\n    }\n    \n    if (!user.playerId) {\n        console.log('[User Role Sync] User has no linked player, skipping');\n        return { success: false, message: 'User has no linked player' };\n    }\n    \n    console.log(`[User Role Sync] Syncing role ${roleId} from user ${user.id} to player ${user.playerId}`);\n    \n    try {\n        const isAssignment = eventType === 'role-assigned';\n        \n        if (isAssignment) {\n            await takaro.player.playerControllerAssignRole(user.playerId, roleId, {});\n            console.log(`[User Role Sync] Successfully assigned role ${roleId} to player ${user.playerId}`);\n        } else {\n            await takaro.player.playerControllerRemoveRole(user.playerId, roleId, {});\n            console.log(`[User Role Sync] Successfully removed role ${roleId} from player ${user.playerId}`);\n        }\n        \n        return { \n            success: true, \n            message: `Role ${isAssignment ? 'assigned to' : 'removed from'} player ${user.playerId}` \n        };\n    } catch (error) {\n        console.error(`[User Role Sync] Failed to sync role:`, error);\n        return { \n            success: false, \n            message: `Failed to sync role: ${error.message}` \n        };\n    }\n}\n\nawait main();\n",
                    "name": "syncUserRoleToPlayer",
                    "description": null
                }
            ],
            "permissions": []
        },
        {
            "tag": "1.0.0",
            "description": "Automatically syncs role assignments from users to their linked in-game players. When a Discord user is assigned or removed from a role, this module ensures that the role is also assigned or removed from their connected in-game player profile.",
            "configSchema": "{\"$schema\":\"http://json-schema.org/draft-07/schema#\",\"type\":\"object\",\"properties\":{},\"required\":[],\"additionalProperties\":false}",
            "uiSchema": "{}",
            "commands": [],
            "hooks": [
                {
                    "function": "import { takaro, data, TakaroUserError } from '@takaro/helpers';\n\nasync function main() {\n    console.log('[User Role Sync] Hook triggered');\n    \n    const eventMeta = data.eventData;\n    const roleId = eventMeta?.role?.id;\n    \n    if (!roleId) {\n        console.error('[User Role Sync] No role ID found in event meta');\n        return { success: false, message: 'No role ID found' };\n    }\n    \n    console.log(`[User Role Sync] Looking for recent role event for role ${roleId}`);\n    \n    // This is the onRoleAssigned hook (ID: d01580ca-1550-4abc-abab-addca12ddf17)\n    const eventType = 'role-assigned';\n    \n    console.log(`[User Role Sync] Searching for ${eventType} events with role ${roleId}`);\n    \n    // Search for recent events with this role\n    let matchingEvents;\n    try {\n        const eventsResponse = await takaro.event.eventControllerSearch({\n            filters: { eventName: [eventType] },\n            sortBy: 'createdAt',\n            sortDirection: 'desc',\n            limit: 20\n        });\n        matchingEvents = eventsResponse.data.data;\n        console.log(`[User Role Sync] Found ${matchingEvents.length} recent ${eventType} events`);\n    } catch (error) {\n        console.error('[User Role Sync] Failed to search for events:', error);\n        return { success: false, message: 'Failed to search for events' };\n    }\n    \n    // Find the event that matches our role and is recent\n    const matchingEvent = matchingEvents.find(e => e.meta?.role?.id === roleId && e.userId && !e.playerId);\n    \n    if (!matchingEvent) {\n        console.log('[User Role Sync] No matching user role event found, skipping');\n        return { success: false, message: 'No matching user role event found' };\n    }\n    \n    const userId = matchingEvent.userId;\n    console.log(`[User Role Sync] Found matching event for user ${userId}`);\n    \n    // Get the user to find their linked player\n    let user;\n    try {\n        const userResponse = await takaro.user.userControllerGetOne(userId);\n        user = userResponse.data.data;\n        console.log('[User Role Sync] Found user:', user.name, 'with playerId:', user.playerId);\n    } catch (error) {\n        console.error('[User Role Sync] Failed to get user:', error);\n        return { success: false, message: 'Failed to get user' };\n    }\n    \n    if (!user.playerId) {\n        console.log('[User Role Sync] User has no linked player, skipping');\n        return { success: false, message: 'User has no linked player' };\n    }\n    \n    console.log(`[User Role Sync] Syncing role ${roleId} from user ${user.id} to player ${user.playerId}`);\n    \n    try {\n        await takaro.player.playerControllerAssignRole(user.playerId, roleId, {});\n        console.log(`[User Role Sync] Successfully assigned role ${roleId} to player ${user.playerId}`);\n        \n        return { \n            success: true, \n            message: `Role assigned to player ${user.playerId}` \n        };\n    } catch (error) {\n        console.error(`[User Role Sync] Failed to sync role:`, error);\n        return { \n            success: false, \n            message: `Failed to sync role: ${error.message}` \n        };\n    }\n}\n\nawait main();",
                    "name": "onRoleAssigned",
                    "description": null,
                    "eventType": "role-assigned",
                    "regex": ""
                },
                {
                    "function": "import { takaro, data, TakaroUserError } from '@takaro/helpers';\n\nasync function main() {\n    console.log('[User Role Sync] Hook triggered');\n    \n    const eventMeta = data.eventData;\n    const roleId = eventMeta?.role?.id;\n    \n    if (!roleId) {\n        console.error('[User Role Sync] No role ID found in event meta');\n        return { success: false, message: 'No role ID found' };\n    }\n    \n    console.log(`[User Role Sync] Looking for recent role event for role ${roleId}`);\n    \n    // This is the onRoleRemoved hook (ID: 2de7ef01-fe9b-4276-93b0-1c3d024062af)\n    const eventType = 'role-removed';\n    \n    console.log(`[User Role Sync] Searching for ${eventType} events with role ${roleId}`);\n    \n    // Search for recent events with this role\n    let matchingEvents;\n    try {\n        const eventsResponse = await takaro.event.eventControllerSearch({\n            filters: { eventName: [eventType] },\n            sortBy: 'createdAt',\n            sortDirection: 'desc',\n            limit: 20\n        });\n        matchingEvents = eventsResponse.data.data;\n        console.log(`[User Role Sync] Found ${matchingEvents.length} recent ${eventType} events`);\n    } catch (error) {\n        console.error('[User Role Sync] Failed to search for events:', error);\n        return { success: false, message: 'Failed to search for events' };\n    }\n    \n    // Find the event that matches our role and is recent\n    const matchingEvent = matchingEvents.find(e => e.meta?.role?.id === roleId && e.userId && !e.playerId);\n    \n    if (!matchingEvent) {\n        console.log('[User Role Sync] No matching user role event found, skipping');\n        return { success: false, message: 'No matching user role event found' };\n    }\n    \n    const userId = matchingEvent.userId;\n    console.log(`[User Role Sync] Found matching event for user ${userId}`);\n    \n    // Get the user to find their linked player\n    let user;\n    try {\n        const userResponse = await takaro.user.userControllerGetOne(userId);\n        user = userResponse.data.data;\n        console.log('[User Role Sync] Found user:', user.name, 'with playerId:', user.playerId);\n    } catch (error) {\n        console.error('[User Role Sync] Failed to get user:', error);\n        return { success: false, message: 'Failed to get user' };\n    }\n    \n    if (!user.playerId) {\n        console.log('[User Role Sync] User has no linked player, skipping');\n        return { success: false, message: 'User has no linked player' };\n    }\n    \n    console.log(`[User Role Sync] Removing role ${roleId} from user ${user.id} to player ${user.playerId}`);\n    \n    try {\n        await takaro.player.playerControllerRemoveRole(user.playerId, roleId, {});\n        console.log(`[User Role Sync] Successfully removed role ${roleId} from player ${user.playerId}`);\n        \n        return { \n            success: true, \n            message: `Role removed from player ${user.playerId}` \n        };\n    } catch (error) {\n        console.error(`[User Role Sync] Failed to sync role:`, error);\n        return { \n            success: false, \n            message: `Failed to sync role: ${error.message}` \n        };\n    }\n}\n\nawait main();",
                    "name": "onRoleRemoved",
                    "description": null,
                    "eventType": "role-removed",
                    "regex": ""
                }
            ],
            "cronJobs": [],
            "functions": [
                {
                    "function": "import { takaro, data, TakaroUserError } from '@takaro/helpers';\n\nasync function main() {\n    console.log('[User Role Sync] Hook triggered');\n    \n    const eventMeta = data.eventData;\n    const roleId = eventMeta?.role?.id;\n    \n    if (!roleId) {\n        console.error('[User Role Sync] No role ID found in event meta');\n        return { success: false, message: 'No role ID found' };\n    }\n    \n    console.log(`[User Role Sync] Looking for recent role event for role ${roleId}`);\n    \n    // Query for the recent role-assigned or role-removed event that triggered this hook\n    // We need to find events from the last few seconds with this role\n    const timestamp = eventMeta.timestamp;\n    const eventType = data.itemId.includes('onRoleAssigned') ? 'role-assigned' : 'role-removed';\n    \n    console.log(`[User Role Sync] Searching for ${eventType} events with role ${roleId}`);\n    \n    // Search for recent events with this role\n    let matchingEvents;\n    try {\n        const eventsResponse = await takaro.event.eventControllerSearch({\n            filters: { eventName: [eventType] },\n            sortBy: 'createdAt',\n            sortDirection: 'desc',\n            limit: 20\n        });\n        matchingEvents = eventsResponse.data.data;\n        console.log(`[User Role Sync] Found ${matchingEvents.length} recent ${eventType} events`);\n    } catch (error) {\n        console.error('[User Role Sync] Failed to search for events:', error);\n        return { success: false, message: 'Failed to search for events' };\n    }\n    \n    // Find the event that matches our role and is recent\n    const matchingEvent = matchingEvents.find(e => e.meta?.role?.id === roleId && e.userId && !e.playerId);\n    \n    if (!matchingEvent) {\n        console.log('[User Role Sync] No matching user role event found, skipping');\n        return { success: false, message: 'No matching user role event found' };\n    }\n    \n    const userId = matchingEvent.userId;\n    console.log(`[User Role Sync] Found matching event for user ${userId}`);\n    \n    // Get the user to find their linked player\n    let user;\n    try {\n        const userResponse = await takaro.user.userControllerGetOne(userId);\n        user = userResponse.data.data;\n        console.log('[User Role Sync] Found user:', user.name, 'with playerId:', user.playerId);\n    } catch (error) {\n        console.error('[User Role Sync] Failed to get user:', error);\n        return { success: false, message: 'Failed to get user' };\n    }\n    \n    if (!user.playerId) {\n        console.log('[User Role Sync] User has no linked player, skipping');\n        return { success: false, message: 'User has no linked player' };\n    }\n    \n    console.log(`[User Role Sync] Syncing role ${roleId} from user ${user.id} to player ${user.playerId}`);\n    \n    try {\n        const isAssignment = eventType === 'role-assigned';\n        \n        if (isAssignment) {\n            await takaro.player.playerControllerAssignRole(user.playerId, roleId, {});\n            console.log(`[User Role Sync] Successfully assigned role ${roleId} to player ${user.playerId}`);\n        } else {\n            await takaro.player.playerControllerRemoveRole(user.playerId, roleId, {});\n            console.log(`[User Role Sync] Successfully removed role ${roleId} from player ${user.playerId}`);\n        }\n        \n        return { \n            success: true, \n            message: `Role ${isAssignment ? 'assigned to' : 'removed from'} player ${user.playerId}` \n        };\n    } catch (error) {\n        console.error(`[User Role Sync] Failed to sync role:`, error);\n        return { \n            success: false, \n            message: `Failed to sync role: ${error.message}` \n        };\n    }\n}\n\nawait main();\n",
                    "name": "syncUserRoleToPlayer",
                    "description": null
                }
            ],
            "permissions": []
        }
    ],
    "takaroVersion": "v0.4.9"
}