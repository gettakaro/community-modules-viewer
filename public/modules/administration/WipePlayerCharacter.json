{"name":"WipePlayerCharacter","author":"TrevorJD","supportedGames":["7 days to die"],"versions":[{"tag":"1.0.0","description":"This module lets players wipe their own in-game character data.  It does require confirmation but it is the responsibility of the player to remove all equipment and armor, etc. before activating.","configSchema":"{\"$schema\":\"http://json-schema.org/draft-07/schema#\",\"type\":\"object\",\"required\":[],\"additionalProperties\":false}","uiSchema":"{}","commands":[{"function":"import { takaro, data, TakaroUserError } from '@takaro/helpers';\n\nconst WIPE_TIMESTAMP_KEY = 'wipe_me_timestamp';\nconst TIMEOUT_MS = 60000; // 60 seconds\n\nasync function main() {\n  const { player, gameServerId, module: mod, pog } = data;\n\n  // Retrieve the timestamp variable\n  const timestampVar = await takaro.variable.variableControllerSearch({\n    filters: {\n      key: [WIPE_TIMESTAMP_KEY],\n      gameServerId: [gameServerId],\n      moduleId: [mod.moduleId],\n      playerId: [pog.playerId],\n    },\n  });\n\n  if (timestampVar.data.data.length === 0) {\n    const prefix = (await takaro.settings.settingsControllerGetOne('commandPrefix', gameServerId)).data.data.value;\n    throw new TakaroUserError(`You need to run ${prefix}wipeme first!`);\n  }\n\n  const savedTime = JSON.parse(timestampVar.data.data[0].value);\n  const elapsed = Date.now() - savedTime;\n\n  if (elapsed > TIMEOUT_MS) {\n    // Clean up the expired timestamp\n    await takaro.variable.variableControllerDelete(timestampVar.data.data[0].id);\n\n    const prefix = (await takaro.settings.settingsControllerGetOne('commandPrefix', gameServerId)).data.data.value;\n    throw new TakaroUserError(`Timeout expired (${Math.round(elapsed / 1000)}s). Run ${prefix}wipeme again.`);\n  }\n\n  // Execute Prismacore's resetplayerdata command\n  // Adjust the command syntax based on your Prismacore setup\n  await takaro.gameserver.gameServerControllerExecuteCommand(gameServerId, {\n    command: `resetplayerdata EOS_${pog.player.epicOnlineServicesId}`,\n  });\n\n  // Clean up the timestamp variable\n  await takaro.variable.variableControllerDelete(timestampVar.data.data[0].id);\n\n  await player.pm('✅ Your player data has been reset. You will need to create a new character.');\n}\n\nawait main();","name":"reallywipeme","description":null,"trigger":"reallywipeme","helpText":"No help text available","arguments":[]},{"function":"import { takaro, data } from '@takaro/helpers';\n\nconst WIPE_TIMESTAMP_KEY = 'wipe_me_timestamp';\n\nasync function main() {\n    const { player, gameServerId, module: mod, pog } = data;\n\n    const currentTime = Date.now();\n\n    // Check if a timestamp variable already exists\n    const existingVar = await takaro.variable.variableControllerSearch({\n        filters: {\n            key: [WIPE_TIMESTAMP_KEY],\n            gameServerId: [gameServerId],\n            moduleId: [mod.moduleId],\n            playerId: [pog.playerId],\n        },\n    });\n\n    if (existingVar.data.data.length > 0) {\n        // Update existing variable\n        await takaro.variable.variableControllerUpdate(existingVar.data.data[0].id, {\n            value: JSON.stringify(currentTime),\n        });\n    } else {\n        // Create new variable\n        await takaro.variable.variableControllerCreate({\n            key: WIPE_TIMESTAMP_KEY,\n            value: JSON.stringify(currentTime),\n            gameServerId: gameServerId,\n            moduleId: mod.moduleId,\n            playerId: pog.playerId,\n        });\n    }\n\n    const prefix = (await takaro.settings.settingsControllerGetOne('commandPrefix', gameServerId)).data.data.value;\n\n    await player.pm('⚠️ WARNING: This will reset your player data!');\n    await player.pm(`Put ALL your gear in an unlocked storage box NOW. Don't forget armor, backpack and hotbar`);\n    await player.pm(`Type ${prefix}reallywipeme within 60 seconds to confirm deletion.`);\n}\n\nawait main();\n","name":"wipeme","description":null,"trigger":"wipeme","helpText":"No help text available","arguments":[]}],"hooks":[],"cronJobs":[],"functions":[],"permissions":[]}],"takaroVersion":"v0.4.9"}